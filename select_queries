/* Υποεργασία 2*/
/*1*/
SELECT "ΌνομαΕπιφάνειας", "ΚωδικόςΧρήστη", "ΚωδικόςΟθόνης"
FROM ΕΠΙΦΑΝΕΙΑ_ΕΡΓΑΣΙΑΣ
WHERE "Διαγραμμένη" = 1 
AND ("Σχόλια" IS NULL OR "Σχόλια" = '');

/*2*/
SELECT ΕΠΙΦΑΝΕΙΑ_ΕΡΓΑΣΙΑΣ."ΌνομαΕπιφάνειας"
FROM ΕΠΙΦΑΝΕΙΑ_ΕΡΓΑΣΙΑΣ, ΧΡΗΣΤΗΣ
WHERE ΕΠΙΦΑΝΕΙΑ_ΕΡΓΑΣΙΑΣ."ΚωδικόςΧρήστη" = ΧΡΗΣΤΗΣ."ΚωδικόςΧρήστη" 
AND ΧΡΗΣΤΗΣ."ΌνομαΧρήστη" = 'Ελένη';

/*3*/
SELECT DISTINCT ΧΡΗΣΤΗΣ."ΚωδικόςΧρήστη", ΧΡΗΣΤΗΣ."ΌνομαΧρήστη", ΕΠΙΦΑΝΕΙΑ_ΕΡΓΑΣΙΑΣ."ΌνομαΕπιφάνειας"
FROM ΧΡΗΣΤΗΣ, ΕΠΙΦΑΝΕΙΑ_ΕΡΓΑΣΙΑΣ, ΕΙΚΟΝΙΔΙΟ
WHERE ΧΡΗΣΤΗΣ."ΚωδικόςΧρήστη" = ΕΠΙΦΑΝΕΙΑ_ΕΡΓΑΣΙΑΣ."ΚωδικόςΧρήστη" 
AND ΕΙΚΟΝΙΔΙΟ."ΌνομαΕπιφάνειας" = ΕΠΙΦΑΝΕΙΑ_ΕΡΓΑΣΙΑΣ."ΌνομαΕπιφάνειας" 
AND ΧΡΗΣΤΗΣ."ΌνομαΧρήστη" LIKE 'Κ%' 
AND ΕΙΚΟΝΙΔΙΟ."ΌνομαΕικονιδίου" = 'Excel';

/*4*/
SELECT DISTINCT ΧΡΗΣΤΗΣ."ΚωδικόςΧρήστη", ΧΡΗΣΤΗΣ."ΌνομαΧρήστη"
FROM ΧΡΗΣΤΗΣ, ΕΠΙΦΑΝΕΙΑ_ΕΡΓΑΣΙΑΣ, ΕΙΚΟΝΙΔΙΟ 
WHERE ΧΡΗΣΤΗΣ."ΚωδικόςΧρήστη" = ΕΠΙΦΑΝΕΙΑ_ΕΡΓΑΣΙΑΣ."ΚωδικόςΧρήστη" 
AND ΕΙΚΟΝΙΔΙΟ."ΌνομαΕπιφάνειας" = ΕΠΙΦΑΝΕΙΑ_ΕΡΓΑΣΙΑΣ."ΌνομαΕπιφάνειας" 
AND (ΕΙΚΟΝΙΔΙΟ."ΌνομαΕικονιδίου" = 'Οικογένεια' OR ΕΙΚΟΝΙΔΙΟ."ΌνομαΕικονιδίου" = 'Δίκτυο')
ORDER BY ΧΡΗΣΤΗΣ."ΌνομαΧρήστη" ASC;

/*5*/
SELECT MAX(ΕΙΚ."ΘέσηΥ") AS "Χαμηλότερο σημείο"
FROM ΧΡΗΣΤΗΣ Χ
JOIN ΕΠΙΦΑΝΕΙΑ_ΕΡΓΑΣΙΑΣ ΕΠ ON Χ."ΚωδικόςΧρήστη" = ΕΠ."ΚωδικόςΧρήστη"
JOIN ΕΙΚΟΝΙΔΙΟ ΕΙΚ ON ΕΠ."ΌνομαΕπιφάνειας" = ΕΙΚ."ΌνομαΕπιφάνειας"
WHERE Χ."ΌνομαΧρήστη" = 'Κατερίνα';

/*6*/
SELECT ROUND(
    CAST((SELECT COUNT(DISTINCT "ΚωδικόςΧρήστη") FROM ΕΠΙΦΑΝΕΙΑ_ΕΡΓΑΣΙΑΣ) AS FLOAT) / 
    (SELECT COUNT(*) FROM ΧΡΗΣΤΗΣ), 
    2
) AS "Ποσοστό χρηστών με επιφάνειες";

/*7*/
SELECT ΕΠ."ΌνομαΕπιφάνειας", ΕΙΚ."ΌνομαΕικονιδίου", ΕΙΚ."ΘέσηΧ", ΕΙΚ."ΘέσηΥ"
FROM ΧΡΗΣΤΗΣ Χ
JOIN ΕΠΙΦΑΝΕΙΑ_ΕΡΓΑΣΙΑΣ ΕΠ ON Χ."ΚωδικόςΧρήστη" = ΕΠ."ΚωδικόςΧρήστη"
JOIN ΕΙΚΟΝΙΔΙΟ ΕΙΚ ON ΕΠ."ΌνομαΕπιφάνειας" = ΕΙΚ."ΌνομαΕπιφάνειας"
WHERE Χ."ΌνομαΧρήστη" = 'Γιώργος'
AND ΕΙΚ."ΘέσηΧ" = (
    SELECT MAX(ΕΙΚ2."ΘέσηΧ")
    FROM ΕΠΙΦΑΝΕΙΑ_ΕΡΓΑΣΙΑΣ ΕΠ2
    JOIN ΕΙΚΟΝΙΔΙΟ ΕΙΚ2 ON ΕΠ2."ΌνομαΕπιφάνειας" = ΕΙΚ2."ΌνομαΕπιφάνειας"
    JOIN ΧΡΗΣΤΗΣ Χ2 ON ΕΠ2."ΚωδικόςΧρήστη" = Χ2."ΚωδικόςΧρήστη"
    WHERE Χ2."ΌνομαΧρήστη" = 'Γιώργος'
);
/*8*/
/*Το LEFT JOIN θα μας φέρει όλους τους χρήστες και θα βάλει 0 εκεί που δεν υπάρχει αντιστοιχία*/
SELECT Χ."ΚωδικόςΧρήστη", Χ."ΌνομαΧρήστη", COUNT(ΕΠ."ΌνομαΕπιφάνειας") AS "ΠλήθοςΕπιφανειών"
FROM ΧΡΗΣΤΗΣ Χ
LEFT JOIN ΕΠΙΦΑΝΕΙΑ_ΕΡΓΑΣΙΑΣ ΕΠ ON Χ."ΚωδικόςΧρήστη" = ΕΠ."ΚωδικόςΧρήστη"
GROUP BY Χ."ΚωδικόςΧρήστη", Χ."ΌνομαΧρήστη"
ORDER BY "ΠλήθοςΕπιφανειών" DESC;

/*9*/
SELECT "ΌνομαΕπιφάνειας", COUNT(*) AS "ΠλήθοςΕικονιδίων"
FROM ΕΙΚΟΝΙΔΙΟ
GROUP BY "ΌνομαΕπιφάνειας"
HAVING COUNT(*) >= 18 /*Μιλάμε για ομάδες δεδομών*/
ORDER BY "ΌνομαΕπιφάνειας" ASC;

/*10*/
SELECT "ΌνομαΕπιφάνειας"
FROM ΕΠΙΦΑΝΕΙΑ_ΕΡΓΑΣΙΑΣ
JOIN ΧΡΗΣΤΗΣ ON ΕΠΙΦΑΝΕΙΑ_ΕΡΓΑΣΙΑΣ."ΚωδικόςΧρήστη" = ΧΡΗΣΤΗΣ."ΚωδικόςΧρήστη"
WHERE ΧΡΗΣΤΗΣ."ΌνομαΧρήστη" = 'Κώστας'

EXCEPT /*Πάρε την πώτη λίστα και αφέραισε την από την δεύτερη*/

SELECT DISTINCT "Όνομα Επιφάνειας"
FROM ΕΙΚΟΝΙΔΙΟ
WHERE ("ΘέσηΧ" BETWEEN 10 AND 500) 
  AND ("ΘέσηΥ" BETWEEN 12 AND 300)

ORDER BY "ΌνομαΕπιφάνειας" ASC;